<main ng-controller="orderControl">
  <h1 class="p-3 text-center font-effect-fire-animation">Quản lý phân loại sản phẩm</h1>
  <div class="container-fluid">
    <div hidden id="prepareImg"></div>
    <!-- Show detail-->
    <div class="d-flex flex-wrap align-items-center justify-content-center">
      <form class="form p-3 col-lg-9 border-start border-end border-info">
        <h3 class="text-warning text-center" ng-if="entity.name">Thông tin "{{entity.name}}"</h3>
        <!-- FIELDS -->
        <div class="row align-items-end mt-1 bg-transparent">
          <div class="col-lg-2">
            <label class="form-label fw-bold">id</label>
            <input class="form-control text-center" ng-value="entity.id" disabled>
          </div>
          <div class="col-lg-10">
            <label class="form-label fw-bold">tài khoản mua</label>
            <select class="form-control bg-primary bg-opacity-25" ng-model="entity.usernameid">
              <option value="{{u.username}}" ng-repeat="u in users">
                {{u.username + ' - '+ u.name}}
              </option>
            </select>
          </div>
          <div class="mt-1 col-lg-12">
            <label class="form-label fw-bold">địa chỉ</label>
            <input class="form-control" ng-model="entity.address">
          </div>
        </div>
        <!-- ORDER DETAILS -->
        <div class="mt-3 accordion accordion-flush" id="accordionFlushExample" ng-if="entity.orderDetails.length">
          <div class="accordion-item">
            <h2 class="accordion-header" id="flush-headingTwo">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                Chi tiết đơn hàng ({{entity.orderDetails.length}})
              </button>
            </h2>
            <div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
              <div class="accordion-body">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Hình ảnh</th>
                      <th>Tên hàng</th>
                      <th>Đơn giá</th>
                      <th>Số lượng</th>
                      <th>Tổng giá</th>
                      <th>Người bán</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="d in entity.orderDetails">
                      <td style="max-width: 100px;">
                        <div class="d-flex flex-wrap align-content-between position-relative">
                          <div ng-if="d.content.content_images.length > 0" class="m-auto mt-3 w-100">
                            <!-- carousel content_images -->
                            <div id="contentImage{{d.id}}" class="carousel slide rounded-3 flex-fill" data-bs-ride="true">
                              <div class="carousel-inner">
                                <div class="carousel-item {{i==0 ? 'active' : ''}} ar3x4"
                                  ng-repeat="(i,image) in d.content.content_images track by $index">
                                  <img ng-src="{{getImage(image)}}" class="fit-img rounded-3 o-fit-cover" alt="{{image}}">
                                  <div class="border text-center">
                                    <label class="w-100 text-muted text-nowrap overflow-hidden" style="text-overflow: ellipsis;">
                                      {{image || 'default image'}}
                                    </label>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- button control -->
                            <button class="carousel-control-prev" type="button" data-bs-target="#contentImage{{d.id}}" data-bs-slide="prev">
                              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#contentImage{{d.id}}" data-bs-slide="next">
                              <span class="carousel-control-next-icon" aria-hidden="true"></span>
                              <span class="visually-hidden">Next</span>
                            </button>
                          </div>
                          <!-- default image -->
                          <div class="w-100 ar16x10 mt-3" ng-if="1 > d.content.content_images.length || !d.content.content_images.length">
                            <img class="fit-img" style="object-fit: cover;" ng-src="{{getImage(undefined)}}" alt="default image"
                              title="Nội dung này chưa có ảnh">
                            <div class="border text-center">
                              <label class="w-100 text-muted text-nowrap overflow-hidden" style="text-overflow: ellipsis;">default.png</label>
                            </div>
                          </div>
                        </div>
                      </td>
                      <td ng-bind="d.content.namecontent"></td>
                      <td ng-bind="d.price|number:0"></td>
                      <td><input class="form-control" type="number" ng-model="d.quantity"></td>
                      <td ng-bind="(d.price*d.quantity)|number:0"></td>
                      <td ng-bind="d.content.usernameid"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- CRUD CONTROL -->
        <div class="mt-3 pt-3 border-top d-flex flex-wrap text-nowrap justify-content-end align-items-center">
          <button class="m-1 btn btn-primary" ng-click="post('orders','id')">Thêm</button>
          <button class="m-1 btn btn-warning" ng-click="put('orders','id')">Sửa</button>
          <button class="m-1 btn btn-danger" ng-click="delete(entity.id,'orders','id')">Xóa</button>
        </div>
      </form>
    </div>

    <!-- Show data -->
    <table class="table table-hover table-info table-striped" style="vertical-align: middle;">
      <thead>
        <tr>
          <th>id</th>
          <th>người mua</th>
          <th>ngày mua</th>
          <th>địa chỉ</th>
          <th class="text-center">control</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="(i,x) in data" ng-dblclick="read(x)">
          <td>{{x.id}}</td>
          <td>{{x.usernameid}}</td>
          <td>{{x.datetime | dateRelative:'dddd, DD-MM-yyyy'}}</td>
          <td>{{x.address}}</td>
          <td class="text-end">
            <button class="btn btn-outline-danger" ng-click="delete(x.id,'orders','id')">delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</main>